!function(e,t){"use strict";class s extends t.Texture{constructor(e){super(e)}getImage(){return{width:this.sourceWidth,height:this.sourceHeight}}setFilters(e,t){}setWraps(e,t){}}var i=spine.Color,n=spine.SkeletonClipping,a=spine.Vector2,r=spine.Utils,l=spine.RegionAttachment,h=spine.MeshAttachment,o=spine.ClippingAttachment;class u{constructor(e,t,s){this.vertices=e,this.numVertices=t,this.numFloats=s}}class p{constructor(e=!0){this.vertexEffect=null,this.tempColor=new i,this.tempColor2=new i,this.vertexSize=8,this.twoColorTint=!1,this.renderable=new u(null,0,0),this.clipper=new n,this.temp=new a,this.temp2=new a,this.temp3=new i,this.temp4=new i,this.twoColorTint=e,e&&(this.vertexSize+=4),this.vertices=r.newFloatArray(1024*this.vertexSize)}draw(e,s=-1,i=-1,n,a){let u=this.clipper,d=this.premultipliedAlpha,c=this.temp,m=this.temp2,g=this.temp3,_=this.temp4,y=this.renderable,A=null,f=null,k=e.drawOrder,x=null,S=e.color,v=!1;-1==s&&(v=!0);for(let e=0,w=k.length;e<w;e++){let w=u.isClipping()?2:8,E=k[e];if(s>=0&&s==E.data.index&&(v=!0),!v){u.clipEndWithSlot(E);continue}i>=0&&i==E.data.index&&(v=!1);let b,D=E.getAttachment(),C=null;if(D instanceof l){let e=D;y.vertices=this.vertices,y.numVertices=4,y.numFloats=w<<2,e.computeWorldVertices(E.bone,y.vertices,0,w),f=p.QUAD_TRIANGLES,A=e.uvs,C=e.region.renderObject.page.name,b=a[C],x=e.color}else{if(!(D instanceof h)){if(D instanceof o){let e=D;u.clipStart(E,e);continue}u.clipEndWithSlot(E);continue}{let e=D;y.vertices=this.vertices,y.numVertices=e.worldVerticesLength>>1,y.numFloats=y.numVertices*w,y.numFloats>y.vertices.length&&(y.vertices=this.vertices=r.newFloatArray(y.numFloats)),e.computeWorldVertices(E,0,e.worldVerticesLength,y.vertices,0,w),f=e.triangles,C=e.region.renderObject.page.name,b=a[C],A=e.uvs,x=e.color}}if(null!=b){let e=E.color,s=this.tempColor;s.r=S.r*e.r*x.r,s.g=S.g*e.g*x.g,s.b=S.b*e.b*x.b,s.a=S.a*e.a*x.a,d&&(s.r*=s.a,s.g*=s.a,s.b*=s.a);let i=E.data.blendMode;if(u.isClipping()){u.clipTriangles(y.vertices,y.numFloats,f,f.length,A,s,null,!1);let e=new Float32Array(u.clippedVertices),a=u.clippedTriangles,r=[],l=[],h=[];if(null!=this.vertexEffect){let t=this.vertexEffect,s=e;for(let i=0,n=e.length;i<n;i+=8)c.x=s[i],c.y=s[i+1],g.set(s[i+2],s[i+3],s[i+4],s[i+5]),m.x=s[i+6],m.y=s[i+7],_.set(0,0,0,0),t.transform(c,m,g,_),s[i]=c.x,s[i+1]=c.y,s[i+2]=g.r,s[i+3]=g.g,s[i+4]=g.b,s[i+5]=g.a,s[i+6]=m.x,s[i+7]=m.y,r.push(s[i],-s[i+1]),h.push(s[i+2],s[i+3],s[i+4],s[i+5]),l.push(s[i+6],s[i+7])}else{let t=0;for(;Number.isFinite(e[t+6])&&Number.isFinite(e[t+7]);)r.push(e[t]),r.push(-e[t+1]),h.push(e[t+2]),h.push(e[t+3]),h.push(e[t+4]),h.push(e[t+5]),l.push(e[t+6]),l.push(e[t+7]),t+=this.vertexSize}let o,p=1,d=null,k=null;switch(i){case 1:o="light";break;case 2:o="multiply";break;case 3:o="screen";break;default:o="normal"}k=(255*h[3]<<24)+255*h[0]|0+(255*h[1]<<8)+(255*h[2]<<16),n.graphics.drawTriangles(b,0,0,r,l,new Uint16Array(a),t.Matrix.EMPTY,p,d,o,k)}else{let e=y.vertices,a=[],r=[],l=[];if(null!=this.vertexEffect){let t=this.vertexEffect;for(let i=0,n=0,h=y.numFloats;i<h;i+=8,n+=2)c.x=e[i],c.y=e[i+1],m.x=A[n],m.y=A[n+1],g.setFromColor(s),_.set(0,0,0,0),t.transform(c,m,g,_),e[i]=c.x,e[i+1]=c.y,e[i+2]=g.r,e[i+3]=g.g,e[i+4]=g.b,e[i+5]=g.a,e[i+6]=m.x,e[i+7]=m.y,a.push(e[i],-e[i+1]),l.push(e[i+2],e[i+3],e[i+4],e[i+5]),r.push(e[i+6],e[i+7])}else for(let t=2,i=0,n=y.numFloats;t<n;t+=8,i+=2)e[t]=s.r,e[t+1]=s.g,e[t+2]=s.b,e[t+3]=s.a,e[t+4]=A[i],e[t+5]=A[i+1],a.push(e[t-2],-e[t-1]),l.push(e[t],e[t+1],e[t+2],e[t+3]),r.push(e[t+4],e[t+5]);let h,o=1,u=null,p=null;switch(i){case 1:h="light";break;case 2:h="multiply";break;case 3:h="screen";break;default:h="normal"}p=(255*l[3]<<24)+255*l[0]|0+(255*l[1]<<8)+(255*l[2]<<16),n.graphics.drawTriangles(b,0,0,a,r,new Uint16Array(f),t.Matrix.EMPTY,o,u,h,p)}}u.clipEndWithSlot(E)}u.clipEnd()}}p.QUAD_TRIANGLES=[0,1,2,2,3,0];var d=spine.TimeKeeper,c=spine.Skeleton,m=spine.AnimationState,g=spine.AnimationStateData;class _ extends t.Sprite{constructor(e=null){super(),this.currentPlayTime=0,this._pause=!0,this._currAniName=null,this._playbackRate=1,this._playAudio=!0,this._soundChannelArr=[],this.trackIndex=0,e&&this.init(e),this._ins=this}init(e){var s=this;this._templet=e,this.skeleton=new c(this._templet.skeletonData),this.stateData=new g(this.skeleton.data),this.state=new m(this.stateData),this.skeletonRenderer=new p(!1),this.timeKeeper=new d,this.skeletonRenderer.premultipliedAlpha=this._templet._spinePremultipliedAlpha,this.state.addListener({start:function(e){},interrupt:function(e){},end:function(e){},dispose:function(e){},complete:function(e){e.loop?s.event(t.Event.COMPLETE):(s._currAniName=null,s.event(t.Event.STOPPED))},event:function(i,n){var a,r={audioValue:n.data.audioPath,audioPath:n.data.audioPath,floatValue:n.floatValue,intValue:n.intValue,name:n.data.name,stringValue:n.stringValue,time:1e3*n.time,balance:n.balance,volume:n.volume};s.event(t.Event.LABEL,r),s._playAudio&&r.audioValue&&(a=t.SoundManager.playSound(e._textureDic.root+r.audioValue,1,t.Handler.create(s,s._onAniSoundStoped),null,(1e3*s.currentPlayTime-r.time)/1e3),t.SoundManager.playbackRate=s._playbackRate,a&&s._soundChannelArr.push(a))}})}play(e,t,s=!0,i=0,n=0,a=!0,r=!0){this._playAudio=r,n/=1e3;var l=e;if((i/=1e3)<0||n<0)throw new Error("SpineSkeleton: start and end must large than zero.");if(0!==n&&i>n)throw new Error("SpineSkeleton: start must less than end.");if("number"==typeof l&&(l=this.getAniNameByIndex(e)),s||this._pause||this._currAniName!=l){this._currAniName=l,this.state.setAnimation(this.trackIndex,l,t);let e=this.state.getCurrent(this.trackIndex);e.animationStart=i,n&&n<e.animationEnd&&(e.animationEnd=n);let s=e.animation.duration;this._duration=s,this._playStart=i,this._playEnd=n<=s?n:s,this._pause&&(this._pause=!1,this.timer.frameLoop(1,this,this._update,null,!0)),this._update()}}_update(){this.timeKeeper.update();let e=this.timeKeeper.delta*this._playbackRate,t=this.state.getCurrent(this.trackIndex);this.state.update(e),this.state.apply(this.skeleton);let s=t.animationLast;this.currentPlayTime=Math.max(0,s),this.state&&this.skeleton&&(this.skeleton.updateWorldTransform(),this._ins.graphics.clear(),this.skeletonRenderer.draw(this.skeleton,-1,-1,this._ins,this._templet._textureDic))}getAnimNum(){return this._templet.skeletonData.animations.length}getAniNameByIndex(e){return this._templet.getAniNameByIndex(e)}getSlotByName(e){return this.skeleton.findSlot(e)}playbackRate(e){this._playbackRate=e}showSkinByName(e){this.showSkinByIndex(this._templet.getSkinIndexByName(e))}showSkinByIndex(e){let t=this.skeleton.data.skins[e];this.skeleton.setSkin(t),this.skeleton.setSlotsToSetupPose()}stop(){this._pause||(this._pause=!0,this._currAniName=null,this.timer.clear(this,this._update),this.state.update(-this.currentPlayTime),this.currentPlayTime=0,this.event(t.Event.STOPPED),this._soundChannelArr.length>0&&this._onAniSoundStoped(!0))}paused(){if(!this._pause&&(this._pause=!0,this.timer.clear(this,this._update),this.event(t.Event.PAUSED),this._soundChannelArr.length>0))for(var e,s=this._soundChannelArr.length,i=0;i<s;i++)(e=this._soundChannelArr[i]).isStopped||e.pause()}resume(){if(this._pause&&(this._pause=!1,this.timer.frameLoop(1,this,this._update,null,!0),this._soundChannelArr.length>0))for(var e,t=this._soundChannelArr.length,s=0;s<t;s++)(e=this._soundChannelArr[s]).audioBuffer&&e.resume()}_onAniSoundStoped(e){for(var t,s=this._soundChannelArr.length,i=0;i<s;i++)((t=this._soundChannelArr[i]).isStopped||e)&&(!t.isStopped&&t.stop(),this._soundChannelArr.splice(i,1),s--,i--)}destroy(e=!0){super.destroy(e),this._templet._removeReference(1),this._templet=null,this.timeKeeper=null,this.skeleton=null,this.state.clearListeners(),this.state=null,this.skeletonRenderer=null,this.timer.clear(this,this._update),this._soundChannelArr.length>0&&this._onAniSoundStoped(!0)}get templet(){return this._templet}addAnimation(e,t=!1,s=0){s/=1e3;var i=e;"number"==typeof i&&(i=this.getAniNameByIndex(i)),this._currAniName=i,this.state.addAnimation(this.trackIndex,i,t,s)}setMix(e,t,s){s/=1e3;var i=e;"number"==typeof i&&(i=this.getAniNameByIndex(i));var n=t;"number"==typeof n&&(n=this.getAniNameByIndex(n)),this.stateData.setMix(i,n,s)}getBoneByName(e){return this.skeleton.findBone(e)}getSkeleton(){return this.skeleton}setSlotAttachment(e,t){this.skeleton.setAttachment(e,t)}set currentTime(e){if(this._currAniName&&this._templet){if((e/=1e3)<this._playStart||this._playEnd&&e>this._playEnd||e>this._duration)throw new Error("AnimationPlayer: value must large than playStartTime,small than playEndTime.");this.state.update(e-this.currentPlayTime),this.currentPlayTime=e}}get playState(){return this._currAniName?this._pause?_.paused:_.playing:_.stopped}}_.stopped=0,_.paused=1,_.playing=2,t.ILaya.regClass(_),t.ClassUtils.regClass("laya.layaspine.SpineSkeleton",_),t.ClassUtils.regClass("Laya.SpineSkeleton",_);var y=spine.SharedAssetManager,A=spine.TextureAtlas,f=spine.AtlasAttachmentLoader,k=spine.SkeletonJson;class x extends t.Resource{constructor(){super(),this._textureDic={},this._isDestroyed=!1,this._layaPremultipliedAlpha=!0,this._spinePremultipliedAlpha=!1}loadAni(e,t=null){let s=e.lastIndexOf("/")+1,i=e.slice(0,s),n=(e=e.slice(s)).replace(".json",".atlas");t||(t=[e.replace(".json",".png")]),this._textureDic.root=i,this._textureUrlList=t,this.clientId=i,this.atlasUrl=n,this.jsonUrl=e,this.assetManager=new y(i),this.assetManager.loadJson(i,e),this.assetManager.loadText(i,n);for(var a,r=0,l=t.length;r<l;r++)a=t[r],this.assetManager.loadTexture(i,this.textureLoader.bind(this),a);window.requestAnimationFrame(this.loop.bind(this))}textureLoader(e){for(var t,i,n=e.url,a=this._textureUrlList,r=0,l=a.length;r<l;r++)if(i=a[r],n.endsWith("/"+i)){t=i;break}return this._textureDic[t]=new s(e.bitmap)}loop(){this.assetManager.isLoadingComplete(this.clientId)?this.parseSpineAni():this.assetManager.hasErrors()?this.event(t.Event.ERROR,"load failed:"+this.assetManager.getErrors()):window.requestAnimationFrame(this.loop.bind(this))}parseSpineAni(){if(this._isDestroyed)this.destroy();else{var e=this,s=new A(this.assetManager.get(this.clientId,this.atlasUrl),(function(t){return e.assetManager.get(e.clientId,t)})),i=new f(s);this.skeletonJson=new k(i),this.skeletonData=this.skeletonJson.readSkeletonData(this.assetManager.get(this.clientId,this.jsonUrl)),this.event(t.Event.COMPLETE,this)}}buildArmature(){return new _(this)}getAniNameByIndex(e){var t=this.skeletonData.animations[e];return t?t.name:null}getSkinIndexByName(e){for(var t=this.skeletonData.skins,s=0,i=t.length;s<i;s++)if(t[s].name==e)return s;return-1}destroy(){var e;for(e in this._isDestroyed=!0,this._textureDic)"root"!=e&&e&&this._textureDic[e].destroy();super.destroy()}}var S=spine.AssetManager,v=spine.AtlasAttachmentLoader,w=spine.SkeletonBinary;class E extends t.Resource{constructor(){super(),this._textureDic={},this._isDestroyed=!1,this._layaPremultipliedAlpha=!0,this._spinePremultipliedAlpha=!1}loadAni(e,s=null){let i=e.lastIndexOf("/")+1,n=e.slice(0,i);e=e.slice(i),this.skelUrl=e;let a=(e=e.replace(".json",".skel")).replace(".skel",".atlas");s||(s=[e.replace(".skel",".png")]),this._textureDic.root=n,this.pathPrefix=n,this.atlasUrl=a,this.textureUrlList=s,this.assetManager=new S(this.textureLoader.bind(this),n),this.assetManager.loadBinary(this.skelUrl),this.assetManager.loadTextureAtlas(a),t.Laya.timer.frameOnce(1,this,this.loop)}textureLoader(e){let t,i,n=e.url,a=this.textureUrlList;for(let e=0,s=a.length;e<s;e++)if(i=a[e],n.endsWith(i)){t=i;break}return this._textureDic[t]=new s(e.bitmap)}loop(){this.assetManager.isLoadingComplete()?this.parseSpineAni():this.assetManager.hasErrors()?this.event(t.Event.ERROR,"load failed:"+this.assetManager.getErrors()):window.requestAnimationFrame(this.loop.bind(this))}parseSpineAni(){if(this._isDestroyed)return void this.destroy();let e=this.assetManager.get(this.atlasUrl),s=new v(e);this.skeletonBinary=new w(s),this.skeletonData=this.skeletonBinary.readSkeletonData(this.assetManager.get(this.skelUrl)),this.event(t.Event.COMPLETE,this)}buildArmature(){return new _(this)}getAniNameByIndex(e){let t=this.skeletonData.animations[e];return t?t.name:null}getSkinIndexByName(e){let t,s=this.skeletonData.skins;for(let i=0,n=s.length;i<n;i++)if(t=s[i],t.name==e)return i;return-1}destroy(){let e;for(e in this._isDestroyed=!0,this._textureDic)"root"!=e&&e&&this._textureDic[e].destroy();super.destroy()}}e.SpineGLTexture=s,e.SpineSkeleton=_,e.SpineSkeletonRenderer=p,e.SpineTemplet=x,e.SpineTempletBinary=E}(window.Laya=window.Laya||{},Laya);